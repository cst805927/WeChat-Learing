# 第 20 章 小程序UI组件库-基于Vant Weapp的生日管家

- 为了提高小程序的开发效率

  可以考虑使用第三方UI组件来实现界面的视觉统一

  - 开发者可以方便的引用

    已经事先设计好的自定义组件

    来快速搭建小程序页面

## 本章学习目标

- 了解小程序自定义组件的概念
- 掌握UI组件库 Vant Weapp 的下载和使用
- 掌握小程序云开发小程序端数据库的相关 API

## 20.1 小程序自定义组件简介

### 20.1.1 什么是自定义组件

- 小程序支持简洁的组件化编程

- 开发者可以将页面内的功能模块制作成自定义组件

  以便在不同的页面中重复使用

  也可以将复杂内容拆分成若干个低耦合的模块

  这样有助于代码的后期维护

- 例如，目前小程序的原生组件中是没有卡片组件的

  开发者可以自行使用图片、按钮、文本等内容

  通过样式布局组合成一个商品

  然后自由应用于多个页面上

  这种组件就是自定义组件

### 20.1.2 自定义组件的引用方式

- 如果需要开发者自定义组件，

  则需要为每个组件编写一套由WXML、WXSS、JSON以及JS几个文件组成的模块代码

  并且使用前需要在对应页面的JSON文件中进行引用声明

  其语法格式如下：

```
  {
  	"usingComponents": {
    	"component-tag-name": "path/to/the/custom/component"
  	}
  }
```

- 其中“component-tag-name”换成自定义的组件名称

  （也就是未来在页面上引用的组件标签名）

- “path/to/the/component”换成自定义组件所在的路径地址即可使用

- 在完成引用声明后

  自定义组件在使用时与小程序原生的基础组件用法非常相似

### 20.1.3 小程序UI组件库 Vant Weapp

- 这里以有赞小程序组件库 Vant Weapp 为例

  从零开始讲解如何使用其开发完成一款生日管家小项目

- Vant Weapp是一款轻量、可靠的小程序UI组件库，

  与有赞移动端组件库Vant基于相同的视觉规范

  并提供一致的API接口

### 20.1.5 Vant Weapp 的下载和安装

#### 1. 方法一：通过npm安装

```
#通过npm安装
npm i @vant/weapp -S --production
```

- 需要注意的是

  package.json和node_modules必须在 miniprogram目录下

#### 2.方法二：通过git下载源代码

- 手动将其中的dist或lib文件夹复制到项目内的自定义路径地址

```
git clone https://github.com/yozan/vant-weapp.git
```

#### 3. 方法三：直接下载源代码

- 直接访问网页下载源代码，

  解压缩后手动将目录中的dist或lib复制到项目内的自定义路径地址中

## 20.2 需求分析

- 本项目一共需要 3 个页面

  即首页、好友信息编辑页和好友信息展示页

### 20.2.1 首页功能需求

- 首页功能需求如下

  - 首页需要包含“添加新朋友”按钮、搜索框和好友列表

  - 点击“添加新朋友”按钮后跳转到好友信息编辑页，可以录入数据

  - 搜索框可以根据好友姓名关键词查找指定好友

  - 好友生日列表需要展示好友姓名、生日、距离下个生日还有多少天，

    并且点击好友头像可以跳转到好友信息展示页查看详情

### 20.2.2 好友信息编辑页功能需求

- 好友信息编辑页功能需求如下：
  - 以表单的形式要求用户录入好友的姓名、性别、生日、电话、关系等信息
  - “保存记录”按钮用于添加或更新好友数据到云数据库中
  - “取消修改”按钮用于取消本次填写，返回上一页

### 20.2.3 好友信息展示页功能需求

- 好友信息展示页功能需求如下
  - 顶端展示好友的头像和姓名
  - 中间列表展示好友的性别、电话、和用户本人的关系、距离出生已经多少天、距离下个生日还有多少天
  - 下方是“修改”按钮和“删除”按钮，分别用于跳转编辑页面和直接删除当前好友

## 20.3 初始化项目

### 20.3.1 创建云模板项目

- 首先需要创建一个云开发项目，

  在任意盘符下创建一个空白文件夹（birthdayMemo）

  然后填入AppID和选中“小程序”、“云开发”

- 接着删除其中无用的模板代码
  1. 删除cloudFunctions文件夹下的默认云函数login的全部内容
  2. 找到app.json文件，打开并删除其中的页面引用，只保留第一个pages/index/index
  3. 打开硬盘中的pages文件夹，删除index以外的所有目录
  4. 进入index文件夹，删除多余的图片，以及JS、WXML和WXSS文件中的全部代码
  5. 删除app.wxss中的代码
  6. 删除image文件夹中的所有图片
  7. 删除style文件夹
  8. 此时项目清理完成

### 20.3.2 部署云数据库

- 具体操作如下
  1. 打开云开发控制台，创建一个新的数据库，例如birthday
  2. 检查birthday数据集的权限，确认是“仅创建者及管理员可读写”

### 20.3.3 创建页面文件

- 本项目由 3 个页面文件，

  - index（首页）
  - edit（好友信息编辑页）
  - detail（好友信息展示页）

- 打开app.json文件，

  在pages属性中追加edit和detail页面的路径描述

- 保存后自动生成后面两个页面，

### 20.3.4 创建其他文件

- 本项目还需要以下 3 个文件夹
  - images：用于存放图片素材，已存在
  - utils：用于存放公共JS文件，需要手动创建
  - vant-weapp：用于存放有赞UI库的dist目录，需要手动创建

#### 1. 添加图片文件

- 本项目将用到一套动物头像卡通图标为

  新增好友随机生成的头像

- 打开images文件夹，创建二级目录avatar，将头像复制进去

#### 2. 创建公共JS文件

- 点击utils文件夹

  选择新建JS

  创建公共文件utils.js

#### 3. 添加UI组件库

- 右击vant-weapp文件夹，

  将事先下载好的Vant Weapp组件库源代码中的dist目录复制、粘贴进去

- 注意：

  - 最后检查一定要将app.json文件中的"style":"v2"手动删除

    这句代码表示使用小程序新版的基础组件样式

    会对当前UI组件库的部分组件造成样式干扰，影响使用效果

## 20.4 视图设计

#### 20.4.1 导航栏设计

- 用户通过在app.json中

  对window属性进行重新配置

  来自定义导航栏的效果

  app.json

```
{
  "pages": [
    "pages/index/index",
    "pages/detail/detail",
    "pages/edit/edit"
  ],
  "window": {
    "navigationBarBackgroundColor": "#DE6E6D",
    "navigationBarTitleText": "生日管家"
  }
}
```

#### 20.4.2 页面设计

##### 1.首页设计

- 首页主要包含 3 部分内容
  - “添加新朋友”按钮
  - 搜索框
  - 好友列表

- 计划使用如下组件
  - 按钮：Vant Weapp中的按钮组件<van-button>
  - 搜索框：Vant Weapp中的搜索组件<van-search>
  - 好友列表：Vant Weapp中的卡片组件<van-card>
- 首先